# grep コマンド

`grep [オプション] 検索条件 ファイル名`

ファイル名は複数指定できる。

## オプション

```bash
-i, --ignore-case             # 大文字と小文字の違いを無視する
-l                            # 検索条件を満たすファイル名のみを表示する
-v [word]                     # 指定した文字に該当しない行を検索する
-c                            # 検索条件を満たすファイル名と一致した件数を表示する
-n, --line-number             # 行番号を表示する
-N / -C N / --context N       # 検索結果の前後 N 行を表示
-A N / --after-context N      # 検索結果の後 N 行を表示
-B N / --before-context N     # 検索結果の前 N 行を表示
-G / --basic-regexp           # 検索条件に基本正規表現(BRE)を使用する。デフォルトはこれ。
-F / --fixed-strings          # 検索条件を正規表現ではなく、固定文字列として解釈する。
-E / --extended-regexp        # 検索条件に拡張正規表現(ERE)を使用する。
```

## 複数条件

- 複数条件の OR: `-e pattern1 -e pattern2`
- 複数条件の AND: `grep A | grep B` 単純に2回 grep する

## 検索条件

検索条件は上にあるようにデフォルトではBREとして解釈される。
シェルが間違った解釈をしないように `"` や `'` で囲っておくと良い。

|          |                                 |
| :------: | :------------------------------ |
|   `^`    | 行の先頭                        |
|   `$`    | 行の末尾                        |
|   `.`    | 任意の 1 文字                   |
|   `*`    | 直線の項目の 0 回以上の繰り返し |
|   `\`    | 正規表現文字のエスケープ        |
| `[...]`  | `[]` 内の任意の 1 文字          |
| `[abc]`  | a, b, c のどれか 1 文字         |
| `[^abc]` | a, b, c 以外の 1 文字           |
| `[a-n]`  | a から n までの 1 文字          |

ERE にすれば以下の正規表現も使用できる。

|         |                                    |
| :-----: | :--------------------------------- |
|   `+`   | 直線の項目の 1 回以上の繰り返し    |
|   `?`   | 直前の項目が 0 回または 1 回       |
|  `{n}`  | 直前の項目が n 回                  |
| `{n,}`  | 直前の項目が n 回以上              |
| `{,m}`  | 直前の項目が m 回以下              |
| `{n,m}` | 直前の項目が n 回以上 m 回以下     |
|  `\<`   | 単語の先頭にある空の文字列と一致   |
|  `\>`   | 単語の終わりにある空の文字列と一致 |

## 左方最短一致と最長一致

`.*` `.+` は最長一致、`.*?` `.+?` は左方最短一致になる。

```bash
echo "<<<tag>>><<<tag>>>" | grep -E '<.*?>' # `<<<tag>` が2箇所一致する(左方最短一致)
echo "<<<tag>>><<<tag>>>" | grep -E '<.*>'  # `<<<tag>>><<<tag>>>` がまるまる一致する(最長一致)
```

**参考**

- <https://qiita.com/anqooqie/items/191ad215e93237c77811>
- <https://future-architect.github.io/articles/20200611/>
- <https://www.gnu.org/software/grep/manual/grep.html#Regular-Expressions>
