# free コマンド

LinuxやUnix系システムでメモリの使用状況を確認するためのコマンド

`-h` オプションをつけると、メモリのサイズを人間が読みやすい形式で表示する。(human-readable)

```bash
free -h
               total        used        free      shared  buff/cache   available
Mem:           3.8Gi       777Mi       112Mi       2.3Mi       3.2Gi       3.1Gi
Swap:          2.0Gi       2.0Mi       2.0Gi
```

通常は以下のようなテーブルが表示される。

**横軸**

- `Mem` はコンピューターに搭載される物理メモリ(RAM)の使用状況
- `Swap` はスワップ領域(ストレージの一部をメモリの代わりに使用する領域)の使用状況。RAM がいっぱいになると OS は「最近使っていないデータ」を一時的に物理メモリから追い出し、この Swap 領域に書き込む。ストレージを使うため、物理メモリに比べて速度が非常に遅い。

**縦軸**

- `total` は合計のメモリ量
- `used` は使用中のメモリ量
- `free` は未使用のメモリ量
- `shared` は複数のプロセスで共有されているメモリ量
- `buff/cache` はバッファやキャッシュに使用されているメモリ量
- `available` は新しいプロセスが使用できるメモリ量 (free + buff/cache の一部)

## free コマンドを見たときに注目すべき点

**Mem の available が多い**
非常に健全

**Mem がほぼ満杯で、Swap の used が 0**
OSがメモリを効率よく使い切っています。まだ大丈夫です。

**Swap の used が増え続けている**
要注意。 物理メモリが足りず、低速なスワップを多用しているため、システムのパフォーマンスが低下しています。

## 継続的に監視する

```bash
free -h -s 2 # 2秒ごとに更新
free -h -s 2 -c 5 # 2秒ごとに更新し、5回だけ表示
```

## その他のオプション

```bash
# Mem と Swap の合計を表示
free -t

# Wide Mode: buffers と cache を分けて表示
free -w

# ローメモリとハイメモリを分けて表示する
# 32bit環境などで、カーネルが直接アクセスできる「Lowメモリ」と、それ以外の「Highメモリ」を分けて表示します（最近の64bitシステムではあまり使いません）。
free -l
```

とりあえずは `free -htw` を実行しておけばよい。
