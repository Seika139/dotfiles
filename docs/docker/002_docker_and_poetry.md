# Docker と Poetry で Python のソースコードを管理する

<!-- markdownlint-disable MD036 -->

Python のソースコードを扱うプロジェクトにおいて、Docker と Poetry を組み合わせることで、高いレベルでの依存関係管理と環境の一貫性を実現できる。

## それぞれができること

- **Docker**: アプリケーションを実行するための OS やインタプリタを統一できる。
- **Poetry**: プロジェクト内で使用する Python パッケージの依存関係を統一できる。

## 4 つのパターンでの比較

### パターン 1: Poetry なし、Docker なし

**統一できること**

- ほとんど何も統一できません。
- 開発者はそれぞれのローカル環境に個別に Python や必要なライブラリをインストールするため、バージョンや依存関係がバラバラになりがちです。
- 異なる開発者間で環境が異なり、動作確認やデプロイ時に予期せぬ問題が発生する可能性が高くなります。
- プロジェクトの依存関係を手動で管理する必要があり、煩雑でエラーも起こりやすいです。

### パターン 2: Poetry あり、Docker なし

**統一できること**

- Python パッケージの依存関係とそのバージョン
  - `pyproject.toml` と `poetry.lock` ファイルによって、プロジェクトに必要なライブラリとその正確なバージョンが定義され、チーム全体で一貫した依存関係を保つことができます。
- ビルドプロセス
  - Poetry はパッケージのビルドと公開のプロセスを標準化します。
- 仮想環境
  - Poetry はプロジェクトごとに独立した仮想環境を管理し、プロジェクト間の依存関係の衝突を防ぎます。

**統一できないこと**

- Python のバージョン
  - 各開発者のローカル環境にインストールされている Python のバージョンは異なる可能性があります。
- OS やシステムライブラリ
  - 開発者の OS やインストールされているシステムライブラリは異なるため、OS 固有の問題やシステムライブラリへの依存がある場合に差異が生じる可能性があります。

### パターン 3: Poetry なし、Docker あり

**統一できること**

- Python のバージョン
  - Docker イメージ内で使用する Python のバージョンを Dockerfile で指定することで、実行環境における Python のバージョンを統一できます。
- OS やシステムライブラリ
  - Docker イメージのベースイメージとして特定の OS や必要なシステムライブラリを含めることで、実行環境を統一できます。
- アプリケーションの実行環境全体
  - Docker コンテナはアプリケーションとその依存関係をまとめてパッケージ化するため、開発、テスト、本番環境で一貫した実行環境を提供できます。

**統一できないこと**

- Python パッケージの依存関係の管理
  - 依存関係のインストールやバージョン管理は Dockerfile 内で手動で行うか、`requirements.txt` などのファイルに記述して pip で行うため、Poetry のような高度な依存関係解決やロックファイルの恩恵は受けられません。依存関係のバージョンが曖昧になったり、不整合が生じたりする可能性があります。

### パターン 4: Poetry あり、Docker あり

**統一できること**

- Python パッケージの依存関係とそのバージョン
  - Poetry によって管理された `pyproject.toml` と `poetry.lock` ファイルに基づいて、Docker イメージ内で正確なバージョンの Python パッケージがインストールされます。
- Python のバージョン
  - `Dockerfile` で指定された Python バージョンがコンテナ内で使用されます。
- OS やシステムライブラリ
  - Docker イメージのベースイメージで指定された OS やシステムライブラリがコンテナ内で提供されます。
- アプリケーションの実行環境全体
  - Poetry で管理された依存関係を含んだ Docker イメージを使用することで、開発、テスト、本番環境で完全に一貫した実行環境を構築できます。

| 特徴                        | Poetry なし、Docker なし | Poetry あり、Docker なし | Poetry なし、Docker あり | Poetry あり、Docker あり |
| :-------------------------- | :----------------------- | :----------------------- | :----------------------- | :----------------------- |
| Python パッケージの依存関係 | ほぼ不可能               | 可能 (バージョン固定)    | 不確実 (手動管理)        | 可能 (バージョン固定)    |
| Python のバージョン         | 不確実                   | 不確実                   | 可能                     | 可能                     |
| OS やシステムライブラリ     | 不確実                   | 不確実                   | 可能                     | 可能                     |
| 実行環境全体                | 不確実                   | 部分的に可能             | 可能                     | 完全に可能               |
| ビルドプロセス              | 手動                     | 標準化                   | 手動                     | 標準化                   |
| 仮想環境                    | 手動                     | 自動化                   | -                        | 自動化 (間接的)          |
